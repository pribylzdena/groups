<header>
  <app-global-navbar></app-global-navbar>
</header>

<div class="page-overlay" *ngIf="isLoading">
  <div class="spinner"></div>
</div>

<div class="notification-container container mt-4">
  <h2 class="mb-4">Notifications</h2>

  <div class="toolbar d-flex flex-wrap justify-content-between align-items-center p-3 bg-white rounded shadow-sm mb-4">
    <div class="search-bar d-flex mb-2 mb-md-0">
      <div class="input-group">
        <span class="input-group-text bg-white border-end-0">
          <i class="bi bi-search"></i>
        </span>
        <input
          type="text"
          class="form-control border-start-0"
          placeholder="Search notifications..."
          [(ngModel)]="searchTerm"
          (input)="applyFilters()"
        />
      </div>
    </div>
    <div class="actions d-flex flex-wrap">
      <div class="dropdown me-2 mb-2 mb-md-0">
        <button class="btn btn-outline-secondary dropdown-toggle" type="button" id="filterDropdown" data-bs-toggle="dropdown" aria-expanded="false">
          <i class="bi bi-funnel me-1"></i> Filters
        </button>
        <ul class="dropdown-menu" aria-labelledby="filterDropdown">
          <li><a class="dropdown-item" (click)="filterBy('all')">All</a></li>
          <li><a class="dropdown-item" (click)="filterBy('unread')">Unread</a></li>
          <li><a class="dropdown-item" (click)="filterBy('read')">Read</a></li>
          <li><hr class="dropdown-divider"></li>
          <li><a class="dropdown-item" (click)="filterByType('all')">All types</a></li>
          <li *ngFor="let type of notificationTypes">
            <a class="dropdown-item" (click)="filterByType(type)">{{ type }}</a>
          </li>
        </ul>
      </div>

      <div class="dropdown me-2 mb-2 mb-md-0">
        <button class="btn btn-outline-secondary dropdown-toggle" type="button" id="sortDropdown" data-bs-toggle="dropdown" aria-expanded="false">
          <i class="bi bi-arrow-down-up me-1"></i> Sort by
        </button>
        <ul class="dropdown-menu" aria-labelledby="sortDropdown">
          <li><a class="dropdown-item" (click)="sortBy('id', 'desc')">Newest first</a></li>
          <li><a class="dropdown-item" (click)="sortBy('id', 'asc')">Oldest first</a></li>
          <li><a class="dropdown-item" (click)="sortBy('name', 'asc')">Name (A-Z)</a></li>
          <li><a class="dropdown-item" (click)="sortBy('subject', 'asc')">Subject (A-Z)</a></li>
          <li><a class="dropdown-item" (click)="sortBy('type', 'asc')">Type (A-Z)</a></li>
        </ul>
      </div>

      <button class="btn btn-primary" [routerLink]="['/notification-create']">
        <i class="bi bi-plus-lg me-1"></i> Add new
      </button>
    </div>
  </div>
  <div class="notification-list" *ngIf="filteredNotifications.length > 0">
    <div *ngFor="let notification of filteredNotifications"
         class="notification-card"
         [ngClass]="{'unread': !isReadByCurrentUser(notification)}" [routerLink]="['/notification-show', notification.id]">
      <div class="notification-content">
        <div class="notification-badge" *ngIf="notification.type">
          <span class="badge rounded-pill" [ngClass]="getTypeBadgeClass(notification.type)">
            {{ notification.type }}
          </span>
        </div>
        <div class="notification-status" *ngIf="!isReadByCurrentUser(notification)">
          <span class="badge bg-primary">New</span>
        </div>
        <div class="notification-info">
          <div class="row">
            <div class="col-md-4">
              <div class="info-group">
                <label>Name</label>
                <p class="mb-0 fw-bold">{{ notification.name }}</p>
              </div>
            </div>
            <div class="col-md-4">
              <div class="info-group">
                <label>Subject</label>
                <p class="mb-0">{{ notification.subject }}</p>
              </div>
            </div>
          </div>
          <div class="row mt-2">
            <div class="col-12">
              <div class="info-group">
                <label>Preview</label>
                <p class="notification-message">{{ notification.text | slice:0:150 }}{{ notification.text.length > 150 ? '...' : '' }}</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div *ngIf="filteredNotifications.length === 0" class="empty-state text-center py-5">
    <i class="bi bi-bell-slash empty-icon"></i>
    <h3 class="mt-3">No notifications found</h3>
    <p class="text-muted">There are no notifications matching your current filters</p>
    <button class="btn btn-outline-primary mt-2" (click)="resetFilters()">
      <i class="bi bi-arrow-repeat me-1"></i> Reset filters
    </button>
  </div>

  <nav *ngIf="totalPages > 1" aria-label="Notification pagination" class="mt-4">
    <ul class="pagination justify-content-center">
      <li class="page-item" [ngClass]="{disabled: currentPage === 1}">
        <a class="page-link" (click)="changePage(currentPage - 1)" aria-label="Previous">
          <span aria-hidden="true">&laquo;</span>
        </a>
      </li>
      <li class="page-item" *ngFor="let page of getPaginationRange()" [ngClass]="{active: currentPage === page}">
        <a class="page-link" (click)="changePage(page)">{{ page }}</a>
      </li>
      <li class="page-item" [ngClass]="{disabled: currentPage === totalPages}">
        <a class="page-link" (click)="changePage(currentPage + 1)" aria-label="Next">
          <span aria-hidden="true">&raquo;</span>
        </a>
      </li>
    </ul>
  </nav>
</div>
