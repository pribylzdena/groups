<div class="schedule-container">
  <div class="header">
    <div class="date-nav">
      <button class="btn btn-icon" (click)="changeWeek(-1)">
        <i class="bi bi-chevron-left"></i>
      </button>
      <h2 class="week-label">{{ getWeekLabel() }}</h2>
      <button class="btn btn-icon" (click)="changeWeek(1)">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
    <div class="actions">
      <button class="btn btn-primary btn-sm" (click)="goToToday()">
        <i class="bi bi-calendar-check"></i> Dnes
      </button>
    </div>
    <app-schedule-sidebar [groupId]="groupId"></app-schedule-sidebar>
  </div>

  <div class="schedule-wrapper">
    <div class="calendar-container">
      <div class="calendar-header">
        <div class="time-column"></div>
        <div *ngFor="let dayInfo of weekDays" class="day-column">
          <div class="day-header" [class.today]="dayInfo.isToday">
            <div class="day-name">{{ dayInfo.shortName }}</div>
            <div class="day-number">{{ dayInfo.day }}</div>
          </div>
        </div>
      </div>

      <div class="calendar-body">
        <div class="time-column">
          <div *ngFor="let hour of hours" class="time-slot">
            <span>{{ hour }}:00</span>
          </div>
        </div>

        <div *ngFor="let dayInfo of weekDays" class="day-column">
          <div class="day-events">
            <div *ngFor="let hour of hours" class="hour-slot"></div>
            <div *ngFor="let event of getEventsForDay(dayInfo.date)"
                 class="event-item"
                 [style.top.%]="calculateEventTop(event)"
                 [style.height.%]="calculateEventHeight(event)"
                 [style.background-color]="event.color"
                 (click)="showEventDetail(event)">
              <div class="event-time">{{ formatEventTime(event) }}</div>
              <div class="event-name">{{ event.name }}</div>
              <div class="event-participants" *ngIf="event.participants && event.participants.length">
                <span class="badge rounded-pill bg-light text-dark">
                  <i class="bi bi-people"></i> {{ event.participants.length }}
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div *ngIf="showEventDetails && selectedEvent" class="custom-modal">
    <div class="custom-modal-overlay" (click)="closeEventDetail()"></div>
    <div class="custom-modal-content">
      <div class="custom-modal-header" [style.background-color]="selectedEvent?.color">
        <h5 class="modal-title">{{ selectedEvent?.name }}</h5>
        <button type="button" class="btn-close" (click)="closeEventDetail()">×</button>
      </div>
      <div class="custom-modal-body">
        <div class="event-detail-time">
          <i class="bi bi-clock"></i> {{ formatEventDateTime(selectedEvent?.startsAt) }} - {{ formatEventTime(selectedEvent) }}
        </div>
        <div class="event-detail-status mt-3">
          <span class="badge" [ngClass]="getStatusClass(selectedEvent?.status)">
            {{ selectedEvent?.status }}
          </span>
        </div>
        <div class="event-detail-participants mt-3" *ngIf="selectedEvent?.participants && selectedEvent?.participants.length">
          <h6>Účastníci:</h6>
          <ul class="list-group">
            <li *ngFor="let participant of selectedEvent?.participants" class="list-group-item d-flex justify-content-between align-items-center">
              {{ participant.user.name }}
              <span class="badge" [ngClass]="participant.confirm ? 'bg-success' : 'bg-secondary'">
                {{ participant.confirm ? 'Potvrzeno' : 'Čeká na potvrzení' }}
              </span>
            </li>
          </ul>
        </div>
      </div>
      <div class="custom-modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeEventDetail()">Zavřít</button>
      </div>
    </div>
  </div>
</div>
